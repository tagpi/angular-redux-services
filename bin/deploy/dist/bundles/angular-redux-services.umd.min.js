!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("lodash"),require("rxjs/operators"),require("@angular/core"),require("redux"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-redux-services",["exports","rxjs","lodash","rxjs/operators","@angular/core","redux","@angular/common"],e):e(t["angular-redux-services"]={},t.rxjs,t._,t.Rx.Observable.prototype,t.ng.core,t._,t.ng.common)}(this,function(t,u,a,p,e,o,r){"use strict";var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),c=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)c.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return c}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}var s=function(o){function t(t,e,r){var n=o.call(this,t)||this;return n.onActivate=e,n.onDeactivate=r,n.active=0,n}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,o),t.prototype.subscribe=function(){var t=this;0===this.active&&this.onActivate(),this.active++;var e=o.prototype.subscribe.apply(this,c(Array.prototype.slice.call(arguments))),r=e.unsubscribe.bind(e);return e.unsubscribe=function(){t.active--,t.active||t.onDeactivate(),r()},e},t}(u.BehaviorSubject),f=function(){function t(t){this.getState=t,this.selections={}}return t.prototype.select=function(t){var e,r=this,n=this.setSlice(t),o=new s(n.value,function(){n.links++,e=n.subscribe(function(t){return o.next(t)})},function(){e.unsubscribe(),n.links--,n.links||r.removeSlice(t)});return o},t.prototype.setSlice=function(t){var e=this.selections[t];if(e)return e;var r=a.get(this.getState(),t),n=new u.BehaviorSubject(r);return n.links=0,this.selections[t]=n},t.prototype.removeSlice=function(t){delete this.selections[t]},t.prototype.createMiddleware=function(){var n=this;return function(t){return function(r){return function(t){var e=r(t);return n.broadcast(n.getState()),e}}}},t.prototype.broadcast=function(t){if(this.selections)for(var e=Object.keys(this.selections),r=e.length-1;-1<r;r--){var n=e[r],o=this.selections[n],i=a.get(t,n);a.isEqual(i,o.getValue())||o.next(i)}},t}(),d=function(){function t(){this.loaded={},this.epic={},this.initQueue=[]}return t.prototype.init=function(t){for(;this.initQueue.length;){var e=this.initQueue.shift();this.add(t,e)}},t.prototype.add=function(t,e){var r=e.constructor.name;t.isInitialized?e.constructor.path?this.identify(t,e):console.error("Redux map static path not found for",r):this.initQueue.push(e)},t.prototype.identify=function(r,n){var o=this,t=n.constructor.path,i=this.loaded[t]=this.loaded[t]||{},e=Object.getOwnPropertyNames(n.constructor.prototype);e&&e.length&&e.forEach(function(t){var e=a.get(n.constructor.prototype[t],"prototype.constructor.__rx__");e&&(e.epic&&o.addEpic(r,n,t,e.epic),e.action&&o.addAction(r,n,t,e.action,i))}),this.addResetAction(r,n,i),Object.keys(i).length&&this.addReducer(r,n,i)},t.prototype.addEpic=function(e,r,n,t){var o,i=r.constructor.path+"."+t.source;this.epic[i]=this.epic[i]||[];var c,s=u.Observable.create(function(t){o=t}).pipe(p.flatMap(function(t){return r[n](t)})),a=t.relay&&r.constructor.path+"."+t.relay;a&&(s=s.pipe(p.map(function(t){return{type:a,payload:t}}))),t.config&&t.config.cancelable?this.epic[i].push(function(t){c&&c.unsubscribe(),c=s.subscribe(function(t){return e.dispatch(t)}),o.next(t.payload)}):(c=s.subscribe(function(t){return e.dispatch(t)}),this.epic[i].push(function(t){o.next(t.payload)}))},t.prototype.addAction=function(o,i,t,e,r){var c=i.constructor.path+"."+t;switch(t){case o.initActionType:case o.resetActionType:c=t}var s=i[t]();s&&(s.config=e.config,r[c]=s,i[t]=function(t){var e;if(s.config.includeRoot&&((t=t||{}).$root=o.getState()),s.config["return"]){var r=s.config["return"],n=r.path?i.constructor.path+"."+r.path:i.constructor.path;e=!0===r?o.select(i.constructor.path):r.action?o.select(o.reduxServiceName).pipe(p.filter(function(t){return t===i.constructor.path+"."+r.action}),p.switchMap(function(){return o.select(n)})):o.select(n)}return o.dispatch({type:c,payload:t}),e})},t.prototype.addReducer=function(t,e,o){var r=e.constructor,n=r.path,i=r.preserve,c=e.constructor.initial||{},s=function(t,e){void 0===t&&(t=c);var r=o[e.type];if(!r)return t;if(r.config.direct)return r(t,e);var n=a.cloneDeep(t);return r(n,a.cloneDeep(e.payload)),n};s.config={path:n,preserve:i},t.add(n,s)},t.prototype.safeDispatch=function(t,e){if(e&&e.type){var r=this.epic[e.type];r&&r.forEach(function(t){return t(e)})}else console.warn("Redux safe dispatch called without action")},t.prototype.addResetAction=function(e,t,r){if(!Object.getOwnPropertyNames(t.constructor.prototype).find(function(t){return t===e.resetActionType})&&!t.constructor.preserve){var n=function(){return t.constructor.initial||{}};n.config={direct:!0},r[e.resetActionType]=n}},t}(),h=function(){function t(){var t,e=this;this.resetActionType="@@RESET",this.isInitialized=!1,this.reducers=((t={})[this.reduxServiceName]=function(t,e){return void 0===t&&(t={}),e.type},t),this.subscriber=new f(function(){return e.getState()}),this.map=new d}return Object.defineProperty(t.prototype,"reduxServiceName",{get:function(){return"@redux-service"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initActionType",{get:function(){return"@@INIT"},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,r){void 0===t&&(t={}),void 0===e&&(e=[]),void 0===r&&(r=!1);var n=(!r&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.compose)(o.applyMiddleware.apply(void 0,c(e,[this.subscriber.createMiddleware()])));this.store=o.createStore(o.combineReducers(this.reducers),t,n),this.isInitialized=!0,this.map.init(this),this.select(this.reduxServiceName).subscribe()},t.prototype.add=function(t,e){this.reducers[t]=e,this.store.replaceReducer(o.combineReducers(this.reducers))},t.prototype.register=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];arguments&&arguments.length&&Array.from(arguments).forEach(function(t){return t&&e.map.add(e,t)})},t.prototype.getState=function(){return this.store.getState()},t.prototype.dispatch=function(t){this.store.dispatch(t),this.map.safeDispatch(this,t)},t.prototype.select=function(t){return this.subscriber.select(t)},t.prototype.reset=function(t){void 0===t&&(t=!1),this.dispatch({type:this.resetActionType,payload:{clearPreserve:t}})},t}();h.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[]},h.ngInjectableDef=e.defineInjectable({factory:function(){return new h},token:h,providedIn:"root"});var l=function(){function t(t,e){this.changeDetectorRef=t,this.reduxService=e,this.async=new r.AsyncPipe(this.changeDetectorRef)}return t.prototype.transform=function(t){var e=this,r=this.reduxService.select(t);return this.sub=r.subscribe(function(){return e.changeDetectorRef.markForCheck()}),this.async.transform(r)},t.prototype.ngOnDestroy=function(){this.async.ngOnDestroy(),this.sub&&this.sub.unsubscribe()},t}();l.decorators=[{type:e.Pipe,args:[{name:"rxState",pure:!1}]}],l.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:h}]};var y=function(){};y.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[l],exports:[l]}]}],t.ReduxModule=y,t.ReduxService=h,t.rxAction=function(n){return void 0===n&&(n={}),n=n||{},function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.action={name:""+e,config:n}}},t.rxEpic=function(n,o,i){return void 0===i&&(i={}),null!==(i=i||{}).cancelable&&i.cancelable!==undefined||(i.cancelable=!0),function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.epic={source:n,relay:o,config:i}}},t.RxStatePipe=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-redux-services.umd.min.js.map
