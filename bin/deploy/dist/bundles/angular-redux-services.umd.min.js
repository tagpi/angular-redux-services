!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("lodash"),require("rxjs/operators"),require("@angular/core"),require("redux"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-redux-services",["exports","rxjs","lodash","rxjs/operators","@angular/core","redux","@angular/common"],e):e(t["angular-redux-services"]={},t.rxjs,t._,t.Rx.Observable.prototype,t.ng.core,t._,t.ng.common)}(this,function(t,o,c,n,e,i,r){"use strict";function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),c=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)c.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return c}var u=function(){function t(t){this.getState=t,this.selections={}}return t.prototype.select=function(t){var e=this.selections[t];if(e)return e;var r=c.get(this.getState(),t),n=new o.BehaviorSubject(r);return this.selections[t]=n},t.prototype.createMiddleware=function(){var n=this;return function(t){return function(r){return function(t){var e=r(t);return n.broadcast(n.getState()),e}}}},t.prototype.broadcast=function(t){if(this.selections)for(var e=Object.keys(this.selections),r=e.length-1;-1<r;r--){var n=e[r],o=this.selections[n],i=c.get(t,n);c.isEqual(i,o.getValue())||o.next(i)}},t}(),a=function(){function t(){this.loaded=[],this.epic={},this.initQueue=[]}return t.prototype.init=function(t){for(;this.initQueue.length;){var e=this.initQueue.shift();this.add(t,e)}},t.prototype.add=function(t,e){var r=e.constructor.name;if(t.isInitialized){var n=e.constructor.path;n?this.loaded.find(function(t){return t===n})?console.warn("Attempted to load duplicate path",n):(this.loaded.push(n),this.identify(t,e)):console.error("Redux map static path not found for",r)}else this.initQueue.push(e)},t.prototype.identify=function(r,n){var o=this,i={},t=Object.getOwnPropertyNames(n.constructor.prototype);t&&t.length&&t.forEach(function(t){var e=c.get(n.constructor.prototype[t],"prototype.constructor.__rx__");e&&(e.epic&&o.addEpic(r,n,t,e.epic),e.action&&o.addAction(r,n,t,e.action,i))}),Object.keys(i).length&&this.addReducer(r,n,i)},t.prototype.addEpic=function(t,e,r,n){var o=e.constructor.path+"."+n.action;(this.epic[o]=this.epic[o]||[]).push(function(t){return e[r](t)})},t.prototype.addAction=function(e,t,r,n,o){var i=t.constructor.path+"."+r,c=t[r]();c.useOpenReducer=!!n.useOpenReducer,o[i]=c,t[r]=function(t){e.dispatch({type:i,payload:t})}},t.prototype.addReducer=function(t,e,o){var r=e.constructor.path,i=e.constructor.initial||{};t.addReducer(r,function(t,e){void 0===t&&(t=i);var r=o[e.type];if(!r)return t;if(r.useOpenReducer)return r(t,e);var n=c.cloneDeep(t);return r(n,c.cloneDeep(e)),n})},t.prototype.safeDispatch=function(e,r){if(r&&r.type){var t=this.epic[r.type];t&&t.forEach(function(t){return t(r.payload).pipe(n.take(1)).subscribe(function(t){return e.dispatch(t)})})}else console.warn("Redux safe dispatch called without action")},t}(),p=function(){function t(){var t=this;this.isInitialized=!1,this.reducers={"@redux-service":function(t,e){return void 0===t&&(t={}),e}},this.subscriber=new u(function(){return t.getState()}),this.map=new a}return t.prototype.init=function(t,e,r){void 0===t&&(t={}),void 0===e&&(e=[]),void 0===r&&(r=!1);var n=(!r&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.compose)(i.applyMiddleware.apply(void 0,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}(e,[this.subscriber.createMiddleware()])));this.store=i.createStore(i.combineReducers(this.reducers),t,n),this.isInitialized=!0,this.map.init(this)},t.prototype.addReducer=function(t,e){this.reducers[t]=e,this.store.replaceReducer(i.combineReducers(this.reducers))},t.prototype.addMap=function(t){this.map.add(this,t)},t.prototype.getState=function(){return this.store.getState()},t.prototype.dispatch=function(t){this.store.dispatch(t),this.map.safeDispatch(this,t)},t.prototype.select=function(t){return this.subscriber.select(t)},t}();p.decorators=[{type:e.Injectable}],p.ctorParameters=function(){return[]};var d=function(){function t(t,e){this.changeDetectorRef=t,this.reduxService=e,this.async=new r.AsyncPipe(this.changeDetectorRef)}return t.prototype.transform=function(t){return this.async.transform(this.reduxService.select(t))},t.prototype.ngOnDestroy=function(){this.async.ngOnDestroy()},t}();d.decorators=[{type:e.Pipe,args:[{name:"rxState",pure:!1}]}],d.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:p}]};var f=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[p]}},t}();f.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[d],exports:[d]}]}],t.ReduxModule=f,t.ReduxService=p,t.rxAction=function(n){return void 0===n&&(n=!1),function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.action={name:""+e,useOpenReducer:n}}},t.rxEpic=function(n){return function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.epic={action:""+n}}},t.Éµa=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-redux-services.umd.min.js.map
