!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/BehaviorSubject"),require("lodash"),require("rxjs/add/operator/take"),require("@angular/core"),require("redux"),require("redux-observable"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-redux-services",["exports","rxjs/BehaviorSubject","lodash","rxjs/add/operator/take","@angular/core","redux","redux-observable","@angular/common"],t):t(e["angular-redux-services"]={},e.Rx,e._,e.Rx.Observable.prototype,e.ng.core,e._,e._,e.ng.common)}(this,function(e,n,c,t,r,i,s,o){"use strict";function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),c=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)c.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return c}var u=function(){function e(e){this.getState=e,this.selections={}}return e.prototype.select=function(e){var t=this.selections[e];if(t)return t;var r=c.get(this.getState(),e),o=new n.BehaviorSubject(r);return this.selections[e]=o},e.prototype.createMiddleware=function(){var o=this;return function(e){return function(r){return function(e){var t=r(e);return o.broadcast(o.getState()),t}}}},e.prototype.broadcast=function(e){if(this.selections)for(var t=Object.keys(this.selections),r=t.length-1;-1<r;r--){var o=t[r],n=this.selections[o];if(!n.observers.length)return n.complete(),void delete this.selections[o];var i=c.get(e,o);c.isEqual(i,n.getValue())||n.next(i)}},e}(),d=function(){function e(){this.loaded=[],this.epic={},this.initQueue=[]}return e.prototype.init=function(e){for(;this.initQueue.length;){var t=this.initQueue.shift();this.add(e,t)}},e.prototype.add=function(e,t){var r=t.constructor.name;if(e.isInitialized){var o=t.constructor.path;o?this.loaded.find(function(e){return e===o})?console.warn("Attempted to load duplicate path",o):(this.loaded.push(o),this.identify(e,t)):console.error("Redux map static path not found for",r)}else this.initQueue.push(t)},e.prototype.identify=function(r,o){var n=this,i={},e=Object.getOwnPropertyNames(o.constructor.prototype);e&&e.length&&e.forEach(function(e){var t=c.get(o.constructor.prototype[e],"prototype.constructor.__rx__");t&&(t.epic&&n.addEpic(r,o,e,t.epic),t.action&&n.addAction(r,o,e,t.action,i))}),Object.keys(i).length&&this.addReducer(r,o,i)},e.prototype.addEpic=function(e,t,r,o){var n=t.constructor.path+"."+o.action;(this.epic[n]=this.epic[n]||[]).push(function(e){return t[r](e)})},e.prototype.addAction=function(t,e,r,o,n){var i=e.constructor.path+"."+r,c=e[r]();c.useOpenReducer=!!o.useOpenReducer,n[i]=c,e[r]=function(e){t.dispatch({type:i,payload:e})}},e.prototype.addReducer=function(e,t,n){var r=t.constructor.path,i=t.constructor.initial||{};e.addReducer(r,function(e,t){void 0===e&&(e=i);var r=n[t.type];if(!r)return e;if(r.useOpenReducer)return r(e,t);var o=c.cloneDeep(e);return r(o,c.cloneDeep(t)),o})},e.prototype.safeDispatch=function(t,r){if(r&&r.type){var e=this.epic[r.type];e&&e.forEach(function(e){return e(r.payload).take(1).subscribe(function(e){return t.dispatch(e)})})}else console.warn("Redux safe dispatch called without action")},e}(),p=function(){function e(){var e=this;this.isInitialized=!1,this.reducers={"@redux-service":function(e,t){return void 0===e&&(e={}),t}},this.subscriber=new u(function(){return e.getState()}),this.map=new d}return e.prototype.init=function(e,t,r){void 0===e&&(e={}),void 0===t&&(t=[]),void 0===r&&(r=!1);var o=(!r&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.compose)(i.applyMiddleware(s.createEpicMiddleware(s.combineEpics.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}(t))),this.subscriber.createMiddleware()));this.store=i.createStore(i.combineReducers(this.reducers),e,o),this.isInitialized=!0,this.map.init(this)},e.prototype.addReducer=function(e,t){this.reducers[e]=t,this.store.replaceReducer(i.combineReducers(this.reducers))},e.prototype.addMap=function(e){this.map.add(this,e)},e.prototype.getState=function(){return this.store.getState()},e.prototype.dispatch=function(e){this.store.dispatch(e),this.map.safeDispatch(this,e)},e.prototype.select=function(e){return this.subscriber.select(e)},e}();p.decorators=[{type:r.Injectable}],p.ctorParameters=function(){return[]};var f=function(){function e(e,t){this.changeDetectorRef=e,this.reduxService=t,this.async=new o.AsyncPipe(this.changeDetectorRef)}return e.prototype.transform=function(e){return this.async.transform(this.reduxService.select(e))},e.prototype.ngOnDestroy=function(){this.async.ngOnDestroy()},e}();f.decorators=[{type:r.Pipe,args:[{name:"rxState",pure:!1}]}],f.ctorParameters=function(){return[{type:r.ChangeDetectorRef},{type:p}]};var h=function(){};h.decorators=[{type:r.NgModule,args:[{imports:[o.CommonModule],declarations:[f],exports:[f],providers:[p]}]}],e.ReduxModule=h,e.ReduxService=p,e.rxAction=function(o){return void 0===o&&(o=!1),function(e,t,r){e[t].__rx__=e.__rx__||{},e[t].__rx__.action={name:""+t,useOpenReducer:o}}},e.rxEpic=function(o){return function(e,t,r){e[t].__rx__=e.__rx__||{},e[t].__rx__.epic={action:""+o}}},e.Éµa=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-redux-services.umd.min.js.map
