!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("lodash"),require("rxjs/operators"),require("@angular/core"),require("redux"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-redux-services",["exports","rxjs","lodash","rxjs/operators","@angular/core","redux","@angular/common"],e):e(t["angular-redux-services"]={},t.rxjs,t._,t.Rx.Observable.prototype,t.ng.core,t._,t.ng.common)}(this,function(t,o,c,s,e,i,r){"use strict";var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function u(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),c=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)c.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return c}function a(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}var p=function(o){function t(t,e,r){var n=o.call(this,t)||this;return n.onActivate=e,n.onDeactivate=r,n.active=0,n}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,o),t.prototype.subscribe=function(){var t=this;0===this.active&&this.onActivate(),this.active++;var e=o.prototype.subscribe.apply(this,a(Array.prototype.slice.call(arguments))),r=e.unsubscribe.bind(e);return e.unsubscribe=function(){t.active--,t.active||t.onDeactivate(),r()},e},t}(o.BehaviorSubject),d=function(){function t(t){this.getState=t,this.selections={}}return t.prototype.select=function(t){var e,r=this,n=this.setSlice(t),o=new p(n.value,function(){n.links++,e=n.subscribe(function(t){return o.next(t)})},function(){e.unsubscribe(),n.links--,n.links||r.removeSlice(t)});return o},t.prototype.setSlice=function(t){var e=this.selections[t];if(e)return e;var r=c.get(this.getState(),t),n=new o.BehaviorSubject(r);return n.links=0,this.selections[t]=n},t.prototype.removeSlice=function(t){delete this.selections[t]},t.prototype.createMiddleware=function(){var n=this;return function(t){return function(r){return function(t){var e=r(t);return n.broadcast(n.getState()),e}}}},t.prototype.broadcast=function(t){if(this.selections)for(var e=Object.keys(this.selections),r=e.length-1;-1<r;r--){var n=e[r],o=this.selections[n],i=c.get(t,n);c.isEqual(i,o.getValue())||o.next(i)}},t}(),f=function(){function t(){this.loaded={},this.epic={},this.initQueue=[]}return t.prototype.init=function(t){for(;this.initQueue.length;){var e=this.initQueue.shift();this.add(t,e)}},t.prototype.add=function(t,e){var r=e.constructor.name;t.isInitialized?e.constructor.path?this.identify(t,e):console.error("Redux map static path not found for",r):this.initQueue.push(e)},t.prototype.identify=function(r,n){var o=this,t=n.constructor.path,i=this.loaded[t]=this.loaded[t]||{},e=Object.getOwnPropertyNames(n.constructor.prototype);e&&e.length&&e.forEach(function(t){var e=c.get(n.constructor.prototype[t],"prototype.constructor.__rx__");e&&(e.epic&&o.addEpic(r,n,t,e.epic),e.action&&o.addAction(r,n,t,e.action,i))}),Object.keys(i).length&&this.addReducer(r,n,i)},t.prototype.addEpic=function(r,n,o,t){var e=n.constructor.path+"."+t.source,i=this.epic[e]=this.epic[e]||[],c=t.relay&&n.constructor.path+"."+t.relay;i.push(function(t){var e=n[o](t);c&&(e=e.pipe(s.map(function(t){return{type:c,payload:t}}))),(e=e.pipe(s.take(1))).subscribe(function(t){return r.dispatch(t)})})},t.prototype.addAction=function(e,t,r,n,o){var i=t.constructor.path+"."+r,c=t[r]();c&&(c.useOpenAction=!!n.useOpenAction,o[i]=c,t[r]=function(t){e.dispatch({type:i,payload:t})})},t.prototype.addReducer=function(t,e,o){var r=e.constructor.path,i=e.constructor.initial||{};t.add(r,function(t,e){void 0===t&&(t=i);var r=o[e.type];if(!r)return t;if(r.useOpenAction)return r(t,e);var n=c.cloneDeep(t);return r(n,c.cloneDeep(e.payload)),n})},t.prototype.safeDispatch=function(t,e){if(e&&e.type){var r=this.epic[e.type];r&&r.forEach(function(t){return t()})}else console.warn("Redux safe dispatch called without action")},t}(),h=function(){function t(){var t=this;this.isInitialized=!1,this.reducers={"@redux-service":function(t,e){return void 0===t&&(t={}),e.type}},this.subscriber=new d(function(){return t.getState()}),this.map=new f}return t.prototype.init=function(t,e,r){void 0===t&&(t={}),void 0===e&&(e=[]),void 0===r&&(r=!1);var n=(!r&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.compose)(i.applyMiddleware.apply(void 0,a(e,[this.subscriber.createMiddleware()])));this.store=i.createStore(i.combineReducers(this.reducers),t,n),this.isInitialized=!0,this.map.init(this)},t.prototype.add=function(t,e){this.reducers[t]=e,this.store.replaceReducer(i.combineReducers(this.reducers))},t.prototype.register=function(t){this.map.add(this,t)},t.prototype.getState=function(){return this.store.getState()},t.prototype.dispatch=function(t){this.store.dispatch(t),this.map.safeDispatch(this,t)},t.prototype.select=function(t){return this.subscriber.select(t)},t}();h.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[]},h.ngInjectableDef=e.defineInjectable({factory:function(){return new h},token:h,providedIn:"root"});var l=function(){function t(t,e){this.changeDetectorRef=t,this.reduxService=e,this.async=new r.AsyncPipe(this.changeDetectorRef)}return t.prototype.transform=function(t){return this.async.transform(this.reduxService.select(t))},t.prototype.ngOnDestroy=function(){this.async.ngOnDestroy()},t}();l.decorators=[{type:e.Pipe,args:[{name:"rxState",pure:!1}]}],l.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:h}]};var y=function(){};y.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[l],exports:[l]}]}],t.ReduxModule=y,t.ReduxService=h,t.rxAction=function(n,t){return void 0===n&&(n=!1),void 0===t&&(t=!1),function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.action={name:""+e,useOpenAction:n}}},t.rxEpic=function(n,o){return function(t,e,r){t[e].__rx__=t.__rx__||{},t[e].__rx__.epic={source:n,relay:o}}},t.RxStatePipe=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-redux-services.umd.min.js.map
